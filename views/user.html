<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style/userStyle.css">
    <title>Alteria Nimbus</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>
</head>
<body id="body">
    <div id="menu" class="container">
        <div class="row">
            <img id="menuicon" src="img/menuicon.png" alt="">
        </div>

        <div id="desplegable">
            <!--Dropdown-->
            <div class="col-md-3">
                <div class="d-grid gap-">
                    <button style="width: 50vw;" id="dropdownmenubar" type="button" class="btn dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <a id="option" style="color: rgba(239, 174, 22, 1); width: 50vw;">{{option}}</a>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownmenubar" style="background-color: rgba(239, 174, 22, 1); text-align: center; width: 50vw;">
                        <li><a class="dropdown-item" onclick="reloadPage('{{username}}')" id="dropdownmenu">Chats</a></li>
                        <li><a class="dropdown-item" href="" id="dropdownmenu">AlterAI</a></li>
                        <li><a class="dropdown-item" href="" id="dropdownmenu">My account</a></li>
                    </ul>
                </div>
            </div>
            <!--Fin dropdown-->
            <!--Lista de chats-->
            <div id="chat" onclick="displayChat('{{username}}', '{{Username}}')">
                <div style="height: 100px; width: 30%; float: left; position: relative; align-items: center;"><img id="avatar" src="img/alterianimbus.png" alt="Profile picture" style="width: 90px;"></div>
                <div style="height: 30px; width: 70%; float: right; position: relative;">Username</div>
            </div>
            <div id="chat" onclick="displayChat('{{username}}', '{{Username}}')">
                <div style="height: 100px; width: 30%; float: left; position: relative; align-items: center;"><img id="avatar" src="https://upload.wikimedia.org/wikipedia/commons/a/af/Default_avatar_profile.jpg" alt="Profile picture" style="width: 90px;"></div>
                <div style="height: 30px; width: 70%; float: right; position: relative;">Username</div>
            </div>
            <div id="chat" onclick="displayChat('{{username}}', '{{Username}}')">
                <div style="height: 100px; width: 30%; float: left; position: relative; align-items: center;"><img id="avatar" src="https://cdn2.iconfinder.com/data/icons/circle-avatars-1/128/050_girl_avatar_profile_woman_suit_student_officer-512.png" alt="Profile picture" style="width: 90px;"></div>
                <div style="height: 30px; width: 70%; float: right; position: relative;">Username</div>
            </div>
            <div id="chat" onclick="displayChat('{{username}}', '{{Username}}')">
                <div style="height: 100px; width: 30%; float: left; position: relative; align-items: center;"><img id="avatar" src="https://static.vecteezy.com/system/resources/previews/002/275/847/non_2x/male-avatar-profile-icon-of-smiling-caucasian-man-vector.jpg" alt="Profile picture" style="width: 90px;"></div>
                <div style="height: 30px; width: 70%; float: right; position: relative;">Username</div>
            </div>
            <div id="chat" onclick="displayChat('{{username}}', '{{Username}}')">
                <div style="height: 100px; width: 30%; float: left; position: relative; align-items: center;"><img id="avatar" src="https://png.pngtree.com/png-clipart/20230927/original/pngtree-man-avatar-image-for-profile-png-image_13001882.png" alt="Profile picture" style="width: 90px;"></div>
                <div style="height: 30px; width: 70%; float: right; position: relative;">Username</div>
            </div>
            {{#friends}}
            <div id="chat" onclick="displayChat('{{username}}', '{{.}}')">
                <div style="height: 100px; width: 30%; float: left; position: relative; align-items: center;"><img id="avatar" src="img/alterianimbus.png" alt="Profile picture" style="width: 90px;"></div>
                <div style="height: 30px; width: 70%; float: right; position: relative;">{{.}}</div>
            </div>
            {{/friends}}
        <!--Fin lista de chats-->
            <br><br><div>
                <div class="col-md-12"><button id="button" onclick="addChat()">+ Add chat</button></div>
            </div>
            <div id="addFriend" class="row">
                <label for="friendUsername">Username:</label>
                <input id="friend" type="text" placeholder="Your friend's username">
                <button id="button2" onclick="this.disabled=true ; addFriend('{{username}}')">+ Add friend</button><br>
                <div id="message" style="width: 50%; text-align: center;"></div>
            </div><br><br>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-12"><img id="logo" src="img/alterianimbusTransparent.png"></div>
        </div>
    </div>

    <div id="chatBox" class="container">
        <div id="screen" class="row">
            <!--Ejemplo de mensaje Usuario 1-->
            <div style="display: flex; flex-direction: row;  color: white; margin-top: 20px;">
                <div style="display: flex; flex-direction: column;">
                    <img style="align-self: flex-start;" id="avatar2" src="img/alterianimbus.png" alt="Profile picture"><!--Cambiar style en id=avatar. En los que viene en las lineas superiores-->
                    <div style="align-self: flex-start;">Username1</div>
                </div>
                <div style="margin-top: 20px; margin-left: 20px; text-align: justify; background-color: rgb(189, 65, 61); border-radius: 6px; padding: 10px;">HELLO Lorem ipsum dolor sit amet consectetur, adipisicing elit. Possimus consequuntur facere quis obcaecati similique placeat quidem quae sed totam et, sint officiis eos quisquam magni, nemo aut impedit earum minima. Lorem ipsum dolor, sit amet consectetur adipisicing elit. Doloremque obcaecati qui a officiis, placeat fuga voluptate assumenda minima sit, eos voluptatem debitis in voluptatibus ipsam, non vitae nam minus nesciunt!</div>
            </div>
            <!--Fin ejemplo de mensaje Usuario 1-->
            <!--Ejemplo de mensaje Usuario 2-->
            <div style="display: flex; flex-direction: row-reverse;  color: white; margin-top: 20px;">
                <div style="display: flex; flex-direction: column;">
                    <img style="align-self: flex-start;" id="avatar2" src="img/alterianimbus.png" alt="Profile picture"><!--Cambiar style en id=avatar. En los que viene en las lineas superiores-->
                    <div style="align-self: flex-start;">Username2</div>
                </div>
                <div style="margin-top: 20px; margin-right: 20px; text-align: justify; background-color: rgb(110, 179, 124); border-radius: 6px; padding: 10px;">HELLO Lorem ipsum dolor sit amet consectetur, adipisicing elit. Possimus consequuntur facere quis obcaecati similique placeat quidem quae sed totam et, sint officiis eos quisquam magni, nemo aut impedit earum minima. Lorem ipsum dolor, sit amet consectetur adipisicing elit. Doloremque obcaecati qui a officiis, placeat fuga voluptate assumenda minima sit, eos voluptatem debitis in voluptatibus ipsam, non vitae nam minus nesciunt!</div>
            </div>
            <!--Fin ejemplo de mensaje Usuario 2-->
        </div>
        <input id="inputMessage" class="col-md-3">
        <button id="button3" class="col-md-3">Send</button>
    </div>

    <!--DATABASE-->
    <!--Username: victorgarciallorente20-->
    <!--Password: oGMeQ2nBfc2JiGBN-->
    <!--mongodb+srv://victorgarciallorente20:oGMeQ2nBfc2JiGBN@cluster0.xi3nezk.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0-->

    <script>
        async function addChat(){
            document.getElementById('button').style.display = "none"
            document.getElementById('addFriend').style.display = "block"
        }

        async function addFriend(username){
            let friend = document.getElementById('friend').value
            const response = await fetch(`/addFriend?username=${username}&friend=${friend}`)
            const isAValidFriend = await response.text()
            let message = document.getElementById('message')
            let buttonAddFriend = document.getElementById('button2')

            message.style.color = 'lightgreen'
            message.innerHTML = 'Adding friend...'

            if (isAValidFriend === "true"){
                await reloadPage(username)
            } else if (isAValidFriend === "false") {
                message.style.color = 'red'
                message.innerHTML = 'Friend does not exist'
                buttonAddFriend.disabled = false
            } else if (isAValidFriend === "duplicated") {
                message.style.color = 'red'
                message.innerHTML = 'Same friend can not be added twice. Reload page or login again if your friend is not on the list'
                buttonAddFriend.disabled = false
            }
        }

        async function reloadPage(username){
            await new Promise(r => setTimeout(r, 1000));
            const response = await fetch(`/reloadUserPage?username=${username}`)
            const newHtml = await response.text()
            const body = document.getElementById("body")
            body.innerHTML = newHtml
        }

        async function displayChat(username, friend) {
            let chatBox = document.getElementById("chatBox")
            chatBox.style.display = 'block'
            console.log(username, friend)
        }
    </script>
</body>
</html>